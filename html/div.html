<!DOCTYPE html>
<html>
    <body>
        <p>POSITION YOUR DEVICES</p>
        <div id="dropzone"  ondrop="drop(event)" ondragover="allowDrop(event)" style="position:relative;border:1px solid #d3d3d3;height:300px">

        </div>

        <div id="startdiv" style="position:relative;border:1px solid #d3d3d3;height:300px">
            <img id="lion" src="lion.png" draggable="true" ondragstart="drag(event)">
        </div>


        <script>

            function findPos(obj) {
                var curleft = curtop = 0;
                if (obj.offsetParent) {
                    do {
                        curleft += obj.offsetLeft;
                        curtop += obj.offsetTop;
                    } while (obj = obj.offsetParent);
                    return [curleft, curtop];
                }
            }

            function allowDrop(ev) {
                ev.preventDefault();
            }

            function drag(ev) {
                //console.log("drag " + ev.target.id + " clientX,clientY " + ev.clientX + " " + ev.clientY);
                //console.log("drag " + ev.target.id + " target offset from parent " + ev.target.offsetLeft + " " + ev.target.offsetTop);
                //console.log("drag parentElement " + ev.target.parentElement.id);
                //console.log("drag offsetParent " + ev.target.offsetParent.id);
                if (ev.target.parentElement !== ev.target.offsetParent) {
                    alert("parentElement is not the same as offsetElement: need to modify html");
                }
                var pos = findPos(ev.target.parentElement);
                var parentX = pos[0];
                var parentY = pos[1];
                //console.log("drag parent position " + parentX + " " + parentY);
                var relX = ev.clientX - parentX - ev.target.offsetLeft;
                var relY = ev.clientY - parentY - ev.target.offsetTop;
                //console.log("drag cursor relative to " + ev.target.id + " " + relX + " " + relY);
                ev.dataTransfer.setData("objID", ev.target.id);
                ev.dataTransfer.setData("relX", relX);
                ev.dataTransfer.setData("relY", relY);
            }

            function drop(ev) {
                ev.preventDefault();
                var data = ev.dataTransfer.getData("objID");
                var relX = Number(ev.dataTransfer.getData("relX"));
                var relY = Number(ev.dataTransfer.getData("relY"));
                var img = document.getElementById(data);
                //console.log("dropping : " + data);
                //console.log("dropping on : " + ev.target.id);
                var canvasX = ev.clientX - ev.target.offsetLeft - relX;
                var canvasY = ev.clientY - ev.target.offsetTop - relY;
                //console.log("drop : " + canvasX + " " + canvasY);

                if (ev.target !== img) { // this happens sometimes... when dragging too close to the edge of the drop target
                    img.parentElement.removeChild(img);
                    ev.target.appendChild(img);
                    img.style.position = "absolute";
                    img.style.top = canvasY + "px";
                    img.style.left = canvasX + "px";
                }
            }

        </script>

    </body>
</html>
